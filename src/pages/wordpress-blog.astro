---
import Layout from '../layouts/Layout.astro';
import BlogPostCard from '../components/BlogPostCard.astro';

// Fetch WordPress posts
async function getWordPressPosts() {
  const response = await fetch('https://vizen.co.uk/wp-json/wp/v2/posts?_embed');
  const posts = await response.json();
  return posts;
}

const posts = await getWordPressPosts();
---

<Layout title="WordPress Blog - VIZEN">
  <h1 class="text-4xl font-heading font-bold text-center mb-8 text-tertiary">VIZEN WordPress Blog</h1>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {posts.map((post) => (
      <BlogPostCard
        title={post.title.rendered}
        excerpt={post.excerpt.rendered}
        image={post._embedded['wp:featuredmedia'] ? post._embedded['wp:featuredmedia'][0].source_url : '/images/default-post-image.jpg'}
        url={`/wordpress-post/${post.id}`}
        date={new Date(post.date).toLocaleDateString()}
        category={post._embedded['wp:term'][0][0].name}
      />
    ))}
  </div>
</Layout>